<ion-header style="margin-top: 0px !important;margin-left: 0px !important;">
    <ion-navbar>
        <div style="align-items: center; display: inline;">
            <img src="./assets/img/vt_icon.png" class="icon">
            <ion-title>
                <!--&nbsp; ( {{wfNavParams.wfFormName}} )&nbsp; 工序:&nbsp; {{wfNavParams.wfProcessName}}-->
            </ion-title>
        </div>
    </ion-navbar>
</ion-header>

<ion-content padding>
    <form [formGroup]="wfInputForm" (ngSubmit)="onSubmit()">
        <ion-grid>
            <!-- header bar -->
            <ion-row wrap class="main headbar">
                <ion-col *ngFor="let wfOrderDetail of wfOrderDetails">
                    <ion-row justify-content-center wrap>
                        <ion-col *ngIf="wfOrderDetail.method === 'input' && wfOrderDetail.process[wfNavProcess]"
                                 no-padding>

                            <ion-row align-items-center>
                                <div class="inputLabel" no-padding>
                                    {{wfOrderDetail.title}}
                                </div>
                                <ion-input *ngIf="wfOrderDetail.type != 'textarea'"
                                           class="gridborder"
                                           disabled
                                           type={{wfOrderDetail.type}}
                                           [ngStyle]="{'width.em':wfOrderDetail.size}"
                                           formControlName={{wfOrderDetail.model}}></ion-input>

                                <ion-textarea *ngIf="wfOrderDetail.type === 'textarea'"
                                              formControlName={{wfOrderDetail.model}}
                                              [ngStyle]="{'width.em':wfOrderDetail.size}"
                                              class="textarea gridborder"></ion-textarea>
                            </ion-row>
                        </ion-col>

                        <!--<ion-col *ngIf="wfOrderDetail.method === 'input' + wfNavProcess" no-padding>-->
                        <!--<ion-row align-items-center>-->
                        <!--<div class="inputLabel" no-padding>-->
                        <!--{{wfOrderDetail.title}}-->
                        <!--</div>-->
                        <!--<ion-input *ngIf="wfOrderDetail.type != 'textarea'" class="gridborder" disabled type={{wfOrderDetail.type}} [ngStyle]="{'width.em':wfOrderDetail.size}" formControlName={{wfOrderDetail.model}}></ion-input>-->

                        <!--<ion-textarea *ngIf="wfOrderDetail.type === 'textarea'"-->
                        <!--formControlName={{wfOrderDetail.model}}-->
                        <!--[ngStyle]="{'width.em':wfOrderDetail.size}"-->
                        <!--class="textarea gridborder"></ion-textarea>-->
                        <!--</ion-row>-->
                        <!--</ion-col>-->

                        <ion-col *ngIf="wfOrderDetail.method === 'break'" no-padding [ngStyle]="{'width.em':wfOrderDetail.size}"></ion-col>

                    </ion-row>
                </ion-col>
            </ion-row>

            <!-- Content Section -->
            <ion-row>
                <!-- Material Info and Serial # -->
                <ion-col class="main" col-5 no-padding>
                    <!-- Header -->
                    <ion-row>
                        <ion-col col-1></ion-col>
                        <ion-col text-center col-7>
                            <h4 class="inputHeader">材料</h4>
                        </ion-col>
                        <ion-col text-center>
                            <h4 class="inputHeader">批号</h4>
                        </ion-col>
                    </ion-row>

                    <!-- Body -->
                    <ion-row *ngFor="let wfRMDetail of wfRMDetails"
                             justify-content-center
                             align-items-center>
                        <ion-col wrap col-auto>
                            <div class="inputLabel">
                                {{wfRMDetail.title}}
                            </div>
                        </ion-col>
                        <ion-col col-6>
                            <ion-input class="gridborder"
                                       disabled
                                       value={{wfInputForm.controls[wfRMDetail.modelName].value}}></ion-input>
                        </ion-col>
                        <ion-col>
                            <ion-input class="gridborder"
                                       value={{wfInputForm.controls[wfRMDetail.modelSerial].value}}></ion-input>
                        </ion-col>
                    </ion-row>
                </ion-col>

                <!-- Production Record + Ageing + Staff input -->
                <ion-col col-7>

                    <!-- Production input field -->
                    <ion-row class="sec"
                             align-self-stretch
                             justify-content-left>

                        <!-- Input field header -->
                        <ion-col col-12>
                            <h4 class="inputHeader">
                                <ion-icon name="clipboard"></ion-icon>
                                &nbsp; 参数要求
                            </h4>
                        </ion-col>

                        <!-- Input field form -->
                        <ion-col *ngFor="let wfInput of wfOpsInputs" col-auto>

                            <!-- Simple Input field -->
                            <ion-row *ngIf="wfInput.method == 'input' && wfInput.process[wfNavProcess]"
                                     align-items-center
                                     justify-content-center>

                                <div *ngIf="wfInput.process[wfNavProcess]"
                                     style="margin-left: 5px;margin-right: 5px;">
                                    {{wfInput.title}}
                                </div>

                                <ion-input
                                        *ngIf="wfInput.type != 'textarea'"
                                        type={{wfInput.type}}
                                        formControlName={{wfInput.model}}
                                        [ngStyle]="{'width.em':wfInput.size}"
                                        class="gridborder"></ion-input>

                                <ion-textarea
                                        *ngIf="wfInput.type === 'textarea'"
                                        formControlName={{wfInput.model}}
                                        [ngStyle]="{'width.em':wfInput.size}"
                                        class="textarea gridborder"></ion-textarea>

                                <button *ngIf="wfInput.scan"
                                        item-end
                                        ion-button
                                        class="barcodeButton"
                                        type="button"
                                        (click)="scanBarcode(wfInput.model)">
                                    扫一扫
                                </button>
                            </ion-row>

                            <ion-row *ngIf="wfInput.method == 'buttons' && wfInput.process[wfNavProcess]"
                                     justify-content-left
                                     align-items-center>
                                <div class="inputLabel">
                                    {{wfInput.title}}
                                </div>

                                <ion-buttons>
                                    <button *ngFor="let button of wfInput.buttons"
                                            (click)="updateForm(wfInput.model, button.value)"
                                            [ngClass]="{'buttonsSelected': wfInputForm.controls[wfInput.model].value === button.value}"
                                            ion-button
                                            round
                                            outline
                                            type="button"
                                            style="width: auto;">
                                        &nbsp; {{button.label}}
                                    </button>
                                </ion-buttons>
                            </ion-row>

                            <ion-col *ngIf="wfInput.method == 'inputs' && wfInput.process[wfNavProcess]">
                                <ion-row *ngIf="wfInput.header" align-items-center justify-content-center>
                                    <div style="width: 45px;"></div>
                                    <div style="text-align: center;">
                                        {{wfInput.header}}
                                    </div>                                                                                                                                                             2
                                </ion-row>

                                <ion-row *ngFor="let option of wfInput.options"
                                         align-items-center
                                         justify-content-center>

                                    <div *ngIf="option.process[wfNavProcess]"
                                         class="inputLabel">
                                        {{option.title}}
                                    </div>
                                    <!-- datetime -->
                                    <div *ngIf="option.type == 'date' && option.process[wfNavProcess]"
                                         [ngStyle]="{'width.em':option.size}"
                                         class="gridborder">
                                        <ion-datetime
                                                formControlName={{option.model}}
                                                displayFormat="DD/MM/YYYY"
                                                pickerFormat="DD MM YYYY"></ion-datetime>
                                    </div>

                                    <ion-input
                                            *ngIf="option.type != 'date' && option.process[wfNavProcess]"
                                            formControlName={{option.model}}
                                            type={{option.type}}
                                            [ngStyle]="{'width.em':option.size}"
                                            class="gridborder"></ion-input>

                                    <button
                                            *ngIf="option.scan && option.process[wfNavProcess]"
                                            item-end
                                            ion-button
                                            class="barcodeButton"
                                            type="button"
                                            (click)="scanBarcode(option.model)">
                                        扫一扫
                                    </button>
                                </ion-row>

                            </ion-col>


                            <ion-col *ngIf="wfInput.method === 'break' && option.process[wfNavProcess]"
                                     no-padding>
                                <div [ngStyle]="{'width.em':wfInput.size}"></div>
                            </ion-col>


                            <ion-row
                                    *ngIf="wfInput.method == 'textarea' && option.process[wfNavProcess]"
                                    align-items-center>
                                <div class="inputLabel">
                                    {{wfInput.title}}
                                </div>
                                <ion-textarea
                                        formControlName={{wfInput.model}}
                                        style="min-width: auto;"
                                        class="gridborder">
                                </ion-textarea>
                            </ion-row>

                        </ion-col>

                    </ion-row>

                    <!-- Workflow People input field -->
                    <ion-row class="sec staff" align-items-center justify-content-left>

                        <!-- Input field header -->
                        <ion-col text-left col-12>
                            <h4 class="inputHeader">
                                <ion-icon name="md-contacts"></ion-icon>
                                &nbsp; 员工信息
                            </h4>
                        </ion-col>

                        <!-- Input field form -->
                        <div *ngFor="let wfInput of wfPplInputs">
                            <ion-row>
                                <ion-col *ngIf="wfInput.process[wfNavProcess]"
                                         col-auto align-items-left justify-content-center>

                                    <!-- Simple Input field -->
                                    <ion-row *ngIf="wfInput.method == 'input' && wfInput.process[wfNavProcess]"
                                             align-items-center
                                             justify-content-center >

                                        <div class="inputLabel">
                                            {{wfInput.title}}
                                        </div>

                                        <ion-input
                                                formControlName={{wfInput.model}}
                                                type={{wfInput.type}}
                                                value={{wfInputForm.controls[wfInput.model].value}}
                                                [ngStyle]="{'width.em':wfInput.size}"
                                                class="gridborder"></ion-input>
                                        <div on-mouseover="showWfOpsInputsAlert(wfInputForm.value.wfOptBadQty, wfInputForm.value.wfOptGoodQty)">
                                            <button *ngIf="wfInput.scan == 1"
                                                    [disabled]="(wfInputForm.value.wfOptBadQty == '' || wfInputForm.value.wfOptGoodQty == '')"
                                                    item-end
                                                    ion-button
                                                    class="barcodeButton"
                                                    type="button"
                                                    (click)="scanBarcode(wfInput.model)">
                                                扫一扫
                                            </button>
                                            <button *ngIf="wfInput.scan == 2"
                                                    [disabled]="(wfInputForm.value.wfOptBadQty == '' || wfInputForm.value.wfOptGoodQty == '')"
                                                    item-end
                                                    ion-button
                                                    class="barcodeButton"
                                                    type="button"
                                                    (click)="scanBarcode(wfInput.model)">
                                                扫一扫
                                            </button>
                                            <button *ngIf="wfInput.scan == 3"
                                                    [disabled]="(wfInputForm.value.wfOptBadQty == '' || wfInputForm.value.wfOptGoodQty == '')"
                                                    item-end
                                                    ion-button
                                                    class="barcodeButton"
                                                    type="button"
                                                    (click)="scanBarcode(wfInput.model)">
                                                扫一扫
                                            </button>
                                        </div>
                                        <div on-mouseover="showWfQCPassAlert(wfInputForm.value.wfQCPass)">
                                            <button *ngIf="wfInput.scan == 4 && wfInput.process[wfNavProcess]"
                                                    [disabled]="!(wfInputForm.value.wfQCPass == 2 || wfInputForm.value.wfQCPass == 1)"
                                                    item-end
                                                    ion-button
                                                    class="barcodeButton"
                                                    type="button"
                                                    (click)="scanBarcode(wfInput.model)">
                                                扫一扫
                                            </button>
                                        </div>
                                    </ion-row>


                                    <ion-row *ngIf="wfInput.method == 'textarea' && wfInput.process[wfNavProcess]" align-items-center>
                                        <div class="inputLabel">
                                            备注
                                        </div>
                                        <ion-textarea formControlName={{wfInput.model}} [ngStyle]="{'width.em':wfInput.size}" class="textarea gridborder"></ion-textarea>
                                    </ion-row>

                                    <!-- Select Buttons -->
                                    <ion-row *ngIf="wfInput.method == 'buttons' && wfInput.process[wfNavProcess]" align-items-center>
                                        <div class="inputLabel">
                                            {{wfInput.title}}
                                        </div>

                                        <ion-input formControlName={{wfInput.model}} hidden></ion-input>


                                        <ion-buttons>
                                            <button ion-button round outline type="button" style="width: auto;" *ngFor="let button of wfInput.buttons" (click)="updateForm(wfInput.model,button.value)" [ngClass]="{'buttonsSelected': wfInputForm.controls[wfInput.model].value === button.value}">
                                                <ion-icon name="{{button.icon}}"></ion-icon>
                                                &nbsp; {{button.label}}
                                            </button>
                                        </ion-buttons>
                                    </ion-row>

                                    <!-- Break -->
                                    <div *ngIf="wfInput.method == 'break' && wfInput.process[wfNavProcess]" [ngStyle]="{'width.em':wfInput.size}">
                                    </div>

                                </ion-col>
                            </ion-row>
                        </div>


                    </ion-row>

                    <ion-row justify-content-end>
                        <button [disabled]="!(wfInputForm.value.wfQCPass == 2 || wfInputForm.value.wfQCPass == 1)" type="submit" ion-button>
                            <ion-icon ios="ios-checkbox-outline" md="md-checkbox-outline">
                                &nbsp; 批次完成
                            </ion-icon>
                        </button>
                        <button ion-button type="button" (click)="takePhoto()">
                            <ion-icon ios="ios-camera" md="md-camera"></ion-icon>
                            &nbsp; 拍照
                        </button>

                    </ion-row>

                </ion-col>

                <ion-col>
                    <ion-row *ngFor="let image of images">
                        <img src="{{image}}" class="img">
                        <ion-img src="{{image}}"></ion-img>
                    </ion-row>
                </ion-col>

            </ion-row>
        </ion-grid>
    </form>
</ion-content>